<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.jpeg"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.ico"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.ico"><link rel="mask-icon" href="/images/avatar.jpeg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://unpkg.com/@fortawesome/fontawesome-free@6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous"><link rel="stylesheet" href="https://unpkg.com/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"yuerer.com","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"hide","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":true,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"}}</script><script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.21.1/config.min.js"></script><meta name="description" content="è¿‘æœŸå·¥ä½œçš„å†…å®¹ä¸»è¦æ˜¯è®¾è®¡ä¸€ä¸ªé€šç”¨çš„æ¸¸æˆæ’è¡Œæ¦œæœåŠ¡å™¨, é€šç”¨çš„å«ä¹‰æŒ‡çš„æ˜¯åŒæ—¶ä¸ºå¤šä¸ªé¡¹ç›®ç»„æä¾›ä¸€å¥—é€šç”¨çš„è§£å†³æ–¹æ¡ˆ, ç»è¿‡ä¸æ–­çš„è°ƒç ”, æœ€ç»ˆå†™ä¸‹æ­¤æ–‡. æœ¬æ–‡å°†ä¼šè®²è¿° æ’è¡Œæ¦œçš„å¤šç§å®ç°æ–¹å¼, ä¸è¿‡æœ€ç»ˆæˆ‘é€‰æ‹©äº† SkipList ä½œä¸ºåº•å±‚çš„æ•°æ®ç»“æ„, å› æ­¤ä¼šç€é‡è®²SkipList. å…ˆæ¥è®²ä¸€ä¸‹æ’è¡Œæ¦œçš„ä¸»è¦åŠŸèƒ½. æ’è¡Œæ¦œä¸»è¦åŠŸèƒ½ æ›´æ–°&#x2F;åˆ é™¤&#x2F;è·å– ä¸€ä¸ª Key åœ¨æŸä¸ª æ’è¡Œæ¦œ ä¸Šçš„ æ’å,"><meta property="og:type" content="article"><meta property="og:title" content="SkipList åŸç†åŠåœ¨æ¸¸æˆæ’è¡Œæ¦œä¸­çš„åº”ç”¨"><meta property="og:url" content="https://yuerer.com/SkipList-%E5%8E%9F%E7%90%86%E5%8F%8A%E5%9C%A8%E6%B8%B8%E6%88%8F%E6%8E%92%E8%A1%8C%E6%A6%9C%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/index.html"><meta property="og:site_name" content="Yuerer&#39;s Blog"><meta property="og:description" content="è¿‘æœŸå·¥ä½œçš„å†…å®¹ä¸»è¦æ˜¯è®¾è®¡ä¸€ä¸ªé€šç”¨çš„æ¸¸æˆæ’è¡Œæ¦œæœåŠ¡å™¨, é€šç”¨çš„å«ä¹‰æŒ‡çš„æ˜¯åŒæ—¶ä¸ºå¤šä¸ªé¡¹ç›®ç»„æä¾›ä¸€å¥—é€šç”¨çš„è§£å†³æ–¹æ¡ˆ, ç»è¿‡ä¸æ–­çš„è°ƒç ”, æœ€ç»ˆå†™ä¸‹æ­¤æ–‡. æœ¬æ–‡å°†ä¼šè®²è¿° æ’è¡Œæ¦œçš„å¤šç§å®ç°æ–¹å¼, ä¸è¿‡æœ€ç»ˆæˆ‘é€‰æ‹©äº† SkipList ä½œä¸ºåº•å±‚çš„æ•°æ®ç»“æ„, å› æ­¤ä¼šç€é‡è®²SkipList. å…ˆæ¥è®²ä¸€ä¸‹æ’è¡Œæ¦œçš„ä¸»è¦åŠŸèƒ½. æ’è¡Œæ¦œä¸»è¦åŠŸèƒ½ æ›´æ–°&#x2F;åˆ é™¤&#x2F;è·å– ä¸€ä¸ª Key åœ¨æŸä¸ª æ’è¡Œæ¦œ ä¸Šçš„ æ’å,"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2020-09-12T07:05:20.000Z"><meta property="article:modified_time" content="2025-10-21T13:50:52.261Z"><meta property="article:author" content="Yuerer"><meta property="article:tag" content="Redis"><meta property="article:tag" content="SkipList"><meta property="article:tag" content="æ¸¸æˆæœåŠ¡å™¨"><meta property="article:tag" content="æ’è¡Œæ¦œ"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://yuerer.com/SkipList-%E5%8E%9F%E7%90%86%E5%8F%8A%E5%9C%A8%E6%B8%B8%E6%88%8F%E6%8E%92%E8%A1%8C%E6%A6%9C%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://yuerer.com/SkipList-%E5%8E%9F%E7%90%86%E5%8F%8A%E5%9C%A8%E6%B8%B8%E6%88%8F%E6%8E%92%E8%A1%8C%E6%A6%9C%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/","path":"SkipList-åŸç†åŠåœ¨æ¸¸æˆæ’è¡Œæ¦œä¸­çš„åº”ç”¨/","title":"SkipList åŸç†åŠåœ¨æ¸¸æˆæ’è¡Œæ¦œä¸­çš„åº”ç”¨"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>SkipList åŸç†åŠåœ¨æ¸¸æˆæ’è¡Œæ¦œä¸­çš„åº”ç”¨ | Yuerer's Blog</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-129491388-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-129491388-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.21.1/third-party/analytics/google-analytics.min.js"></script><link rel="dns-prefetch" href="https://yuerer-comment-xufei-0bea01e6f05-1307930306.ap-shanghai.app.tcloudbase.com"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Yuerer's Blog</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">é’°å„¿çš„Blog</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="æœç´¢" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">æ–‡ç« ç›®å½•</li><li class="sidebar-nav-overview">ç«™ç‚¹æ¦‚è§ˆ</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%92%E8%A1%8C%E6%A6%9C%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="nav-text">æ’è¡Œæ¦œä¸»è¦åŠŸèƒ½</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%92%E8%A1%8C%E6%A6%9C%E6%8E%92%E5%BA%8F%E6%96%B9%E6%A1%88"><span class="nav-text">æ’è¡Œæ¦œæ’åºæ–¹æ¡ˆ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%9A%84%E6%8A%89%E6%8B%A9"><span class="nav-text">æ•°æ®ç»“æ„çš„æŠ‰æ‹©</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%92%E8%A1%8C%E6%A6%9C%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0"><span class="nav-text">æ’è¡Œæ¦œæœåŠ¡å®ç°</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SkipList-%E5%8E%9F%E7%90%86"><span class="nav-text">SkipList åŸç†</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis-%E4%B8%AD-SkipList-%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-text">Redis ä¸­ SkipList çš„å®ç°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Insert-%E6%8F%92%E5%85%A5%E6%93%8D%E4%BD%9C"><span class="nav-text">Insert æ’å…¥æ“ä½œ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GetRank-%E8%8E%B7%E5%8F%96%E6%8E%92%E5%90%8D"><span class="nav-text">GetRank è·å–æ’å</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GetElementByRank-%E6%A0%B9%E6%8D%AE%E6%8E%92%E5%90%8D%E6%89%BE%E5%AF%B9%E8%B1%A1"><span class="nav-text">GetElementByRank æ ¹æ®æ’åæ‰¾å¯¹è±¡</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%92%E8%A1%8C%E6%A6%9C%E7%9A%84%E5%8F%A6%E7%B1%BB%E5%81%9A%E6%B3%95"><span class="nav-text">æ’è¡Œæ¦œçš„å¦ç±»åšæ³•</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Yuerer" src="/images/avatar.jpeg"><p class="site-author-name" itemprop="name">Yuerer</p><div class="site-description" itemprop="description">é’°å„¿çš„Blog</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">65</span> <span class="site-state-item-name">æ—¥å¿—</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">16</span> <span class="site-state-item-name">åˆ†ç±»</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">90</span> <span class="site-state-item-name">æ ‡ç­¾</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/Yu2erer" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;Yu2erer" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:yu2erer#gmail.com" title="E-Mail â†’ mailto:yu2erer#gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://yuerer.com/SkipList-%E5%8E%9F%E7%90%86%E5%8F%8A%E5%9C%A8%E6%B8%B8%E6%88%8F%E6%8E%92%E8%A1%8C%E6%A6%9C%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpeg"><meta itemprop="name" content="Yuerer"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Yuerer's Blog"><meta itemprop="description" content="é’°å„¿çš„Blog"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="SkipList åŸç†åŠåœ¨æ¸¸æˆæ’è¡Œæ¦œä¸­çš„åº”ç”¨ | Yuerer's Blog"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline">SkipList åŸç†åŠåœ¨æ¸¸æˆæ’è¡Œæ¦œä¸­çš„åº”ç”¨</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºæ—¶é—´ï¼š2020-09-12 15:05:20" itemprop="dateCreated datePublished" datetime="2020-09-12T15:05:20+08:00">2020-09-12</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">åˆ†ç±»äº</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index"><span itemprop="name">æ¸¸æˆè®¾è®¡</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Walineï¼š</span> <a title="waline" href="/SkipList-%E5%8E%9F%E7%90%86%E5%8F%8A%E5%9C%A8%E6%B8%B8%E6%88%8F%E6%8E%92%E8%A1%8C%E6%A6%9C%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/SkipList-%E5%8E%9F%E7%90%86%E5%8F%8A%E5%9C%A8%E6%B8%B8%E6%88%8F%E6%8E%92%E8%A1%8C%E6%A6%9C%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/" itemprop="commentCount"></span> </a></span><span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°"><span class="post-meta-item-icon"><i class="far fa-eye"></i> </span><span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span> <span class="waline-pageview-count" data-path="/SkipList-%E5%8E%9F%E7%90%86%E5%8F%8A%E5%9C%A8%E6%B8%B8%E6%88%8F%E6%8E%92%E8%A1%8C%E6%A6%9C%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/"></span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>è¿‘æœŸå·¥ä½œçš„å†…å®¹ä¸»è¦æ˜¯è®¾è®¡ä¸€ä¸ªé€šç”¨çš„æ¸¸æˆæ’è¡Œæ¦œæœåŠ¡å™¨, é€šç”¨çš„å«ä¹‰æŒ‡çš„æ˜¯åŒæ—¶ä¸ºå¤šä¸ªé¡¹ç›®ç»„æä¾›ä¸€å¥—é€šç”¨çš„è§£å†³æ–¹æ¡ˆ, ç»è¿‡ä¸æ–­çš„è°ƒç ”, æœ€ç»ˆå†™ä¸‹æ­¤æ–‡.</p><p>æœ¬æ–‡å°†ä¼šè®²è¿° æ’è¡Œæ¦œçš„å¤šç§å®ç°æ–¹å¼, ä¸è¿‡æœ€ç»ˆæˆ‘é€‰æ‹©äº† SkipList ä½œä¸ºåº•å±‚çš„æ•°æ®ç»“æ„, å› æ­¤ä¼šç€é‡è®²SkipList.</p><p>å…ˆæ¥è®²ä¸€ä¸‹æ’è¡Œæ¦œçš„ä¸»è¦åŠŸèƒ½.</p><h2 id="æ’è¡Œæ¦œä¸»è¦åŠŸèƒ½"><a href="#æ’è¡Œæ¦œä¸»è¦åŠŸèƒ½" class="headerlink" title="æ’è¡Œæ¦œä¸»è¦åŠŸèƒ½"></a>æ’è¡Œæ¦œä¸»è¦åŠŸèƒ½</h2><ul><li>æ›´æ–°&#x2F;åˆ é™¤&#x2F;è·å– ä¸€ä¸ª Key åœ¨æŸä¸ª æ’è¡Œæ¦œ ä¸Šçš„ æ’å, åŠå±•ç¤ºä¿¡æ¯</li><li>è·å– ä¸€ä¸ªæ’è¡Œæ¦œ ä»»æ„åŒºé—´(ä¾‹å¦‚æ’ååŒºé—´) çš„å±•ç¤ºä¿¡æ¯</li></ul><h2 id="æ’è¡Œæ¦œæ’åºæ–¹æ¡ˆ"><a href="#æ’è¡Œæ¦œæ’åºæ–¹æ¡ˆ" class="headerlink" title="æ’è¡Œæ¦œæ’åºæ–¹æ¡ˆ"></a>æ’è¡Œæ¦œæ’åºæ–¹æ¡ˆ</h2><p>æ¸¸æˆä¸­çš„æ’è¡Œæ¦œçš„æ’åºæ–¹æ¡ˆæ— éå°±ä¸¤ç§</p><ul><li>å®æ—¶æ’åº, å³ç©å®¶æ•°å€¼å˜åŒ–çš„ç¬é—´, å°±å®Œæˆäº†å¯¹å®ƒçš„æ’åº</li><li>éå®æ—¶æ’åº, äº¦å¯ç§°ä¹‹ä¸ºå®šæ—¶æ’åº, ç©å®¶æ•°æ®å˜åŠ¨ä¸ç«‹å³æ’åº, è€Œæ˜¯ç›´åˆ°ç­–åˆ’æ‰€é…çš„æ—¶é—´ç‚¹åˆ°çš„æ—¶å€™æ‰è¿›è¡Œæ’åº</li></ul><p>è¿™ä¸¤ç§æ’åºæ–¹æ¡ˆæ²¡æœ‰å¥½åä¹‹åˆ†, ä¸»è¦æ˜¯çœ‹ç­–åˆ’ä»–æƒ³è¦ä»€ä¹ˆ? <del>(æˆ–è®¸ä»–è‡ªå·±ä¹Ÿä¸çŸ¥é“æƒ³è¦ä»€ä¹ˆ, ä»–éƒ½æƒ³è¯•è¯•çœ‹, ä»–åªé¡¾ç€ä»–è‡ªå·±)</del></p><span id="more"></span><h2 id="æ•°æ®ç»“æ„çš„æŠ‰æ‹©"><a href="#æ•°æ®ç»“æ„çš„æŠ‰æ‹©" class="headerlink" title="æ•°æ®ç»“æ„çš„æŠ‰æ‹©"></a>æ•°æ®ç»“æ„çš„æŠ‰æ‹©</h2><p>é¦–å…ˆ, å› ä¸ºæˆ‘ä»¬è¦æä¾›ç»™å¤šä¸ªé¡¹ç›®ç»„ä¸€å¥—è§£å†³æ–¹æ¡ˆ, æ¯ä¸ªé¡¹ç›®ç»„éœ€è¦çš„æ’åºæ–¹æ¡ˆå¤§æ¦‚ç‡æ˜¯ä¸åŒçš„, å› æ­¤ æ’é™¤äº†å®šæ—¶æ’åº, å¦‚æœä¸€å¼€å§‹å°±å¾€å®šæ—¶æ’åºçš„æ€è·¯ä¸Šæƒ³, åˆ°æ—¶å€™å“ªä¸ªé¡¹ç›®ç»„çªç„¶è¯´è¦å®æ—¶æ’åº, æ”¹åŠ¨èµ·æ¥ä¼šéå¸¸ç—›è‹¦, è€Œä¸”å®šæ—¶æ’åºå®ç°èµ·æ¥æ¯”è¾ƒç®€å•, ç›´æ¥åˆ°ç‚¹å¿«æ’å°±å®Œäº‹äº†.</p><p>é‚£ä¹ˆ æ’é™¤äº† å®šæ—¶æ’åº, å°±åªèƒ½æœç€å®æ—¶æ’åºçš„æ€è·¯ä¸Šèµ°.</p><p>ä¸šç•Œä¸€èˆ¬é‡‡ç”¨ä¸¤ç§æ•°æ®ç»“æ„è¿›è¡Œå®ç°</p><ul><li>RB Tree çº¢é»‘æ ‘<ul><li>ä¼˜åŠ¿:<ul><li>æ—¶é—´å¤æ‚åº¦çš„å¸¸æ•°ç›¸å¯¹ SkipList ä½</li><li>å†…å­˜å ç”¨ä¹Ÿç›¸å¯¹è¾ƒä½</li></ul></li><li>ä¸è¶³:<ul><li>å®ç°å¤æ‚</li><li>ä¸èƒ½æ–¹ä¾¿çš„è·å–åˆ°æŸä¸ªåŒºé—´çš„ä¿¡æ¯</li></ul></li></ul></li><li>SkipList è·³è¡¨<ul><li>å’Œ çº¢é»‘æ ‘ ç›¸å</li></ul></li></ul><p>æˆ–è®¸ å †ä¹Ÿå¯ä»¥åŠ è¿›å», å–topK, ä½†æ˜¯è¶…å‡ºäº†ké¡¹, å°±ä¸çŸ¥é“æ’å.</p><p>SkipList åœ¨ redis çš„æœ‰åºé›†åˆä¸­ä¹Ÿæœ‰ç”¨åˆ°, è¿™æ—¶å€™å¯èƒ½ä¼šæœ‰äººé—® ä¸ºä»€ä¹ˆä½ ä¸è€ƒè™‘ç›´æ¥ç”¨ redis å‘¢?</p><p>æˆ‘è€ƒè™‘çš„ç‚¹ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹</p><ol><li>å¼•å…¥ redis ä¼šå¢åŠ éƒ¨ç½²éš¾åº¦</li><li>å¼•å…¥ redis ä»…ä»…åªç”¨æ¥åšæ’åº, æ˜¯ä¸æ˜¯å¤ªç¬¨é‡äº†?</li><li>redis çš„é»˜è®¤ SkipList å®ç°æ˜¯ä»å°åˆ°å¤§, è€Œæˆ‘ä»¬çŸ¥é“ä¸€èˆ¬æ˜¯åˆ†å€¼è¶Šé å‰çš„è¶Šç»å¸¸è®¿é—®, å¦‚æœä»å°åˆ°å¤§ æŸ¥æ‰¾é å‰çš„æ•ˆç‡å¯èƒ½ä¸å¦‚ä»å¤§åˆ°å°, ä½†æ˜¯ redis å†™æ­»æ’åºé¡ºåºäº†, æˆ‘ä¸å¼€å¿ƒ</li><li>ç°åœ¨æ¸¸æˆæœåŠ¡å™¨ä¸ºäº†é¿å…å®•æœºçš„é£é™©, éƒ½ä¼šæŠŠæœåŠ¡å™¨æ‹†çš„ç‰¹åˆ«ç»†, ä½†æ˜¯è¿™å°±ä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜, æœ¬æ¥ä¸€ä»¶äº‹æƒ…èƒ½åœ¨ä¸€ä¸ªåœ°æ–¹é›†ä¸­å¤„ç†å®Œ, ç°åœ¨è¦å¤šèµ°å‡ æ¡é“¾è·¯æ‰èƒ½åšå®Œ, æ•ˆç‡ä¼šå˜ä½, å¦‚æœå†åŠ å…¥ä¸€ä¸ª redis, é“¾è·¯åªä¼šæ›´é•¿</li></ol><p>ä¸è¿‡, æˆ‘ä»¬å®ç°çš„æ—¶å€™å¯ä»¥å‚è€ƒ redis çš„ SkipList.</p><h2 id="æ’è¡Œæ¦œæœåŠ¡å®ç°"><a href="#æ’è¡Œæ¦œæœåŠ¡å®ç°" class="headerlink" title="æ’è¡Œæ¦œæœåŠ¡å®ç°"></a>æ’è¡Œæ¦œæœåŠ¡å®ç°</h2><p>é¦–å…ˆ æˆ‘ä»¬è¦æŠ½è±¡å‡º key å’Œ value è¿™ä¸¤ä¸ªæ¦‚å¿µ, key ä½ å¯ä»¥ç†è§£ä¸º playerID, é‚£ä¹‹æ‰€ä»¥å« key æ˜¯å› ä¸º æœ‰çš„æ’è¡Œæ¦œå®ƒä¸æ˜¯ä»¥è§’è‰²ä¸ºå•ä½, å®ƒä¹Ÿæœ‰å¯èƒ½æ˜¯ä»¥å® ç‰©ä¸ºå•ä½, æ­¤æ—¶çš„ key å°±æ˜¯ petID. value å°±æ˜¯åˆ†å€¼, ä¸è¿‡è¿™é‡Œä¸èƒ½ç®€å•åœ°å°±ä¸€ä¸ªåˆ†å€¼, è¯•æƒ³ä¸€ä¸‹, å¦‚æœåˆ†å€¼ç›¸åŒäº†æ€ä¹ˆåŠ?</p><p>ä»¥ä¸‹ä»£ç å‡ä¸ºä¼ªä»£ç , éšæ‰‹ä¸€å†™.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Value</span> &#123;</span><br><span class="line">    <span class="type">uint64_t</span> score;</span><br><span class="line">    <span class="comment">// åŠ å…¥æ“ä½œæ—¶é—´è¿™ä¸€æ¦‚å¿µ, å¦‚æœåˆ†å€¼ç›¸åŒ, å…ˆæ¥æ’å‰</span></span><br><span class="line">    <span class="type">int64_t</span> operatorTime;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Data</span> &#123;</span><br><span class="line">    <span class="type">uint64_t</span> key;</span><br><span class="line">    Value value;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>Data è¡¨ç¤ºçš„å°±æ˜¯ è¿™ä¸ª key ç”¨äºæ’åºçš„ä¿¡æ¯, é‚£ä¹ˆè¿™æ—¶å€™æœ‰ä¸ªé—®é¢˜ å¦‚æœ è¿™ä¸ª key åŒæ—¶å‡ºç°åœ¨ A, B ä¸¤ä¸ªæ’è¡Œæ¦œ, é‚£ä¹ˆ key å°±å¯èƒ½é€ æˆæ•°æ®å†—ä½™, å ç”¨å†…å­˜, è¿™ä¸ªæ—¶å€™ å°±è¦æ”¹é€  Data è¿™ä¸€ ç»“æ„.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Data</span> &#123;</span><br><span class="line">    <span class="type">uint64_t</span> key;</span><br><span class="line">    <span class="comment">// Value value;</span></span><br><span class="line">    <span class="comment">// [leaderBoardID, value]</span></span><br><span class="line">    Value unordered_map&lt;<span class="type">uint32_t</span>, Value&gt; value;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™ å¦‚æœä¸€ä¸ª key å‡ºç°åœ¨å¤šä¸ªæ’è¡Œæ¦œ åªéœ€è¦åœ¨ è¿™ä¸ª map é‡Œ é€šè¿‡ æ’è¡Œæ¦œID å»æ‰¾å±äºè¿™ä¸ªæ’è¡Œæ¦œçš„åˆ†å€¼å°±è¡Œäº†.</p><p>æ­¤æ—¶åˆå‡ºç°äº†ä¸€ä¸ªé—®é¢˜, player key å’Œ pet key æœ‰å¯èƒ½ç›¸åŒ é€šè¿‡ key æ¥æŸ¥æ‰¾æ•°æ® æ˜¾ç„¶æ˜¯ä¸åˆç†çš„.</p><p>è¿™æ—¶å€™å°±è¦å¼•å…¥ä¸€ä¸ª DataType å¯ä»¥ç†è§£ä¸º key çš„ç±»å‹, å®ƒä¸ æ’è¡Œæ¦œLeaderBoard ç»‘å®šåœ¨ä¸€èµ·.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">uint32_t</span> DataType;</span><br><span class="line">vector&lt;Data&gt; DataArray;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LeaderBoard</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> leaderBoardID;</span><br><span class="line">    DataType dataType;</span><br><span class="line">    <span class="comment">// çœŸæ­£å»æ’åºçš„ SkipList</span></span><br><span class="line">    SkipList list;</span><br><span class="line">&#125;;</span><br><span class="line">score = DataArray[leaderBoard.dataType].value[leaderboard.leaderBoard.ID].score;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±èƒ½é€šè¿‡ æ’è¡Œæ¦œ åæŸ¥åˆ°å…¶æ——ä¸‹çš„æ’è¡Œä¿¡æ¯.</p><p>è®²æ¸…æ¥šäº†æ’è¡Œæ¦œçš„è®¾è®¡, æ¥ä¸‹æ¥å°±æ˜¯é‡å¤´æˆ SkipList çš„å®ç°, è¿™é‡Œæˆ‘ æ‹¿å‡º Redis çš„æºç æ¥è®²è§£.</p><h2 id="SkipList-åŸç†"><a href="#SkipList-åŸç†" class="headerlink" title="SkipList åŸç†"></a>SkipList åŸç†</h2><p>å…¶å®ä½ å¯ä»¥è¿™ä¹ˆç†è§£, æ™®é€šçš„é“¾è¡¨ æœç´¢ä¸€ä¸ªä¸œè¥¿ è¦éå†ä¸€æ¬¡ æ—¶é—´å¤æ‚åº¦ä¸º O(n), è¦æƒ³æé«˜æœç´¢é€Ÿåº¦, å°±è¦å°½å¯èƒ½è·³è¿‡å¤šçš„èŠ‚ç‚¹, é‚£ä¹ˆç»™å®ƒå»ºå¤šæ¡ç´¢å¼•é“¾å°±è¡Œäº†.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    .â”€.                .â”€.               .â”€.</span><br><span class="line">â”‚  Head  â”œâ”€â”€â–¶(Minâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ <span class="number">7</span> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶<span class="number">99</span> )  Level <span class="number">3</span></span><br><span class="line">â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜    `â”€<span class="string">&#x27;                `â”¬&#x27;</span>               `â”¬&#x27;</span><br><span class="line">     â”‚                            â”‚                 â”‚</span><br><span class="line">â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”    .â”€.    .â”€.         .â–¼.   .â”€.         .â–¼.</span><br><span class="line">â”‚  Head  â”œâ”€â”€â–¶(Minâ”€â”€â–¶( <span class="number">3</span> â”€â”€â”€â”€â”€â”€â”€â”€â–¶ <span class="number">7</span> â”€â”€â–¶<span class="number">30</span> â”€â”€â”€â”€â”€â”€â”€â”€â–¶<span class="number">99</span> )  Level <span class="number">2</span></span><br><span class="line">â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜    `â”€<span class="string">&#x27;    `â”¬&#x27;</span>         `â”¬<span class="string">&#x27;   `â”¬&#x27;</span>         `â”¬&#x27;</span><br><span class="line">     â”‚                â”‚           â”‚     â”‚           â”‚</span><br><span class="line">â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”    .â”€.    .â–¼.   .â”€.   .â–¼.   .â–¼.   .â”€.   .â–¼.</span><br><span class="line">â”‚  Head  â”œâ”€â”€â–¶(Minâ”€â”€â–¶( <span class="number">3</span> â”€â”€â–¶ <span class="number">9</span> â”€â”€â–¶ <span class="number">7</span> â”€â”€â–¶<span class="number">30</span> â”€â”€â–¶<span class="number">90</span> â”€â”€â–¶<span class="number">99</span> )  Level <span class="number">1</span></span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    `â”€<span class="string">&#x27;    `â”€&#x27;</span>   `â”€<span class="string">&#x27;   `â”€&#x27;</span>   `â”€<span class="string">&#x27;   `â”€&#x27;</span>   `â”€&#x27;</span><br></pre></td></tr></table></figure><p>ä»æœ€ä¸Šé¢çš„ç´¢å¼•é“¾è¡¨å¼€å§‹æœ 30 çš„æ’å å¯ä»¥åƒä¸‹é¢è¿™æ ·æœç´¢</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    .â”€.                .â”€.               .â”€.</span><br><span class="line">â”‚  Head  â”œâ”€â”€â–¶(Minâ”€â”€â”€â”€â”€â”€<span class="number">3</span>â”€â”€â”€â”€â”€â”€â”€â”€â–¶ <span class="number">7</span> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶<span class="number">99</span> )  Level <span class="number">3</span></span><br><span class="line">â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜    `â”€<span class="string">&#x27;                `â”¬&#x27;</span>               `â”¬&#x27;</span><br><span class="line">	 â”‚                            â”‚                 â”‚</span><br><span class="line">â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”    .â”€.    .â”€.         .â–¼.   .â”€.         .â–¼.</span><br><span class="line">â”‚  Head  â”œâ”€â”€â–¶(Minâ”€â”€â–¶( <span class="number">3</span> â”€â”€â”€â”€â”€â”€â”€â”€â–¶ <span class="number">7</span>  <span class="number">1</span>â–¶<span class="number">30</span> â”€â”€â”€â”€â”€â”€â”€â”€â–¶<span class="number">99</span> )  Level <span class="number">2</span></span><br><span class="line">â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜    `â”€<span class="string">&#x27;    `â”¬&#x27;</span>         `â”¬<span class="string">&#x27;   `â”¬&#x27;</span>         `â”¬&#x27;</span><br><span class="line">     â”‚                â”‚           â”‚     â”‚           â”‚</span><br><span class="line">â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”    .â”€.    .â–¼.   .â”€.   .â–¼.   .â–¼.   .â”€.   .â–¼.</span><br><span class="line">â”‚  Head  â”œâ”€â”€â–¶(Minâ”€â”€â–¶( <span class="number">3</span> â”€â”€â–¶ <span class="number">9</span> â”€â”€â–¶ <span class="number">7</span> â”€â”€â–¶<span class="number">30</span> â”€â”€â–¶<span class="number">90</span> â”€â”€â–¶<span class="number">99</span> )  Level <span class="number">1</span></span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    `â”€<span class="string">&#x27;    `â”€&#x27;</span>   `â”€<span class="string">&#x27;   `â”€&#x27;</span>   `â”€<span class="string">&#x27;   `â”€&#x27;</span>   `â”€&#x27;</span><br></pre></td></tr></table></figure><p>min åé¢ è¦è·¨è¶Š span &#x3D; 3 æ‰èƒ½åˆ° 7, 7è¦è·¨è¶Š span &#x3D; 1 æ‰èƒ½åˆ° 30, å› æ­¤ 30 ä»å°åˆ°å¤§ä¸ºç¬¬å››å.</p><p>è‡³æ­¤, æˆ‘ä»¬çŸ¥é“ skiplist æœ¬è´¨å°±æ˜¯å¤šä¸ªç´¢å¼• å¿«é€ŸæŸ¥æ‰¾, åŒæ—¶ç»´æŠ¤äº†ä¸€ä¸ª spanå€¼, æ¥å¿«é€Ÿå¾—åˆ° æ’å</p><h3 id="Redis-ä¸­-SkipList-çš„å®ç°"><a href="#Redis-ä¸­-SkipList-çš„å®ç°" class="headerlink" title="Redis ä¸­ SkipList çš„å®ç°"></a>Redis ä¸­ SkipList çš„å®ç°</h3><p>é¦–å…ˆæ˜¯è¦ç¡®å®š, æˆ‘ä»¬æå‡ä¸€ä¸ªèŠ‚ç‚¹åˆ°ç´¢å¼•é“¾çš„æ¦‚ç‡, å’Œ è¦å»ºå¤šå°‘æ¡ç´¢å¼•é“¾, redis ä¸­ æœ€å¤§å±‚çº§ä¸º32å±‚, æ¯æ¬¡æå‡èŠ‚ç‚¹çš„æ¦‚ç‡ä¸º 0.25.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> ZSKIPLIST_MAXLEVEL 32</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ZSKIPLIST_P 0.25</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">zslRandomLevel</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">    <span class="type">int</span> level = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> ((random()&amp;<span class="number">0xFFFF</span>) &lt; (ZSKIPLIST_P * <span class="number">0xFFFF</span>))</span><br><span class="line">        level += <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (level&lt;ZSKIPLIST_MAXLEVEL) ? level : ZSKIPLIST_MAXLEVEL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ä¸ªéšæœºç®—æ³•, å¯ä»¥ç²—ç•¥çš„è®¡ç®—</p><ul><li>å±‚æ•°ä¸º 1, æ¦‚ç‡ä¸º 1 - p</li><li>å±‚æ•°ä¸º 2, æ¦‚ç‡ä¸º (1 - p)*p</li><li>å±‚æ•°ä¸º 3, æ¦‚ç‡ä¸º (1 - p)<em>p</em>p</li></ul><p>å¹³å‡å±‚æ•°ä¸º (1-p)+ (1-p)*p + (1-p)<em>p</em>p + â€¦ &#x3D; 1 &#x2F; 1 - p</p><p>å¦‚æœæŒ‰ç…§ redis çš„æå‡æ¦‚ç‡ 0.25 æ¥ç®—, é‚£ä¹ˆç©ºé—´ä¸Šè†¨èƒ€ (4 &#x2F; 3) å³ 1.33å€.</p><p>ä¸‹é¢æ¥çœ‹ SkipList çš„å®šä¹‰.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> &#123;</span></span><br><span class="line">    <span class="comment">// ä¸€ä¸ªå¯¹è±¡, å½“åˆ†å€¼ç›¸åŒæ—¶, å®ƒå†³å®šäº†å…ˆåé¡ºåº, å¯ä»¥å¿½è§†</span></span><br><span class="line">    robj *obj;</span><br><span class="line">    <span class="comment">// åˆ†å€¼</span></span><br><span class="line">    <span class="type">double</span> score;</span><br><span class="line">    <span class="comment">// å›é€€æŒ‡é’ˆ, å…¶å®åŸºæœ¬ç”¨ä¸ä¸Š</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> *<span class="title">backward</span>;</span></span><br><span class="line">    <span class="comment">// æ¯ä¸€å±‚</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistLevel</span> &#123;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‰è¿›æŒ‡é’ˆ</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> *<span class="title">forward</span>;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·ç¦»åä¸€ä¸ªèŠ‚ç‚¹è¦èµ°å‡ æ­¥, ç”¨æ¥ç®— æ’å</span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span> span;</span><br><span class="line"></span><br><span class="line">    &#125; level[];</span><br><span class="line"></span><br><span class="line">&#125; zskiplistNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">zskiplist</span> &#123;</span></span><br><span class="line">    <span class="comment">// å¤´å’Œå°¾èŠ‚ç‚¹</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> *<span class="title">header</span>, *<span class="title">tail</span>;</span></span><br><span class="line">    <span class="comment">// è¡¨ä¸­èŠ‚ç‚¹çš„æ•°é‡, ä¸ç„¶å®ƒä»å°åˆ°å¤§æ’åº, ä½ æ€ä¹ˆæ‰¾æœ€å¤§çš„?</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> length;</span><br><span class="line">    <span class="comment">// æœ€å¤§å±‚æ•° ä¸è¶…è¿‡ 32å±‚</span></span><br><span class="line">    <span class="type">int</span> level;</span><br><span class="line"></span><br><span class="line">&#125; zskiplist;</span><br></pre></td></tr></table></figure><h3 id="Insert-æ’å…¥æ“ä½œ"><a href="#Insert-æ’å…¥æ“ä½œ" class="headerlink" title="Insert æ’å…¥æ“ä½œ"></a>Insert æ’å…¥æ“ä½œ</h3><p>ä¸»è¦æ˜¯ä»æœ€é«˜å±‚, ä¾æ¬¡å‘ä¸‹æ‰¾ æ–°æ¥çš„å€¼åº”è¯¥æ’å…¥åˆ°å“ª, ç„¶å ä¿å­˜åˆ° update è¿™ä¸ªæ•°ç»„ä¸­, è¿™æ ·å°±ä¸ç”¨æ¯æ‰¾ä¸€å±‚å°±æ”¹ä¸€å±‚.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">zskiplistNode *<span class="title function_">zslInsert</span><span class="params">(zskiplist *zsl, <span class="type">double</span> score, robj *obj)</span> &#123;</span><br><span class="line">    zskiplistNode *update[<span class="number">32</span>], *x;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> rank[<span class="number">32</span>];</span><br><span class="line">    <span class="type">int</span> i, level;</span><br><span class="line"></span><br><span class="line">    x = zsl-&gt;header;</span><br><span class="line">    <span class="keyword">for</span> (i = zsl-&gt;level<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æœ€é¡¶å±‚çš„èµ·å§‹ rankå€¼å½“ç„¶æ˜¯ 0</span></span><br><span class="line">        rank[i] = i == (zsl-&gt;level<span class="number">-1</span>) ? <span class="number">0</span> : rank[i+<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»å°åˆ°å¤§æ’</span></span><br><span class="line">        <span class="keyword">while</span> (x-&gt;level[i].forward &amp;&amp;</span><br><span class="line">            (x-&gt;level[i].forward-&gt;score &lt; score ||</span><br><span class="line">                (x-&gt;level[i].forward-&gt;score == score &amp;&amp;</span><br><span class="line">                compareStringObjects(x-&gt;level[i].forward-&gt;obj,obj) &lt; <span class="number">0</span>))) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è·¨åº¦å°±æ˜¯ æ’å</span></span><br><span class="line">            rank[i] += x-&gt;level[i].span;</span><br><span class="line"></span><br><span class="line">            x = x-&gt;level[i].forward;</span><br><span class="line">        &#125;</span><br><span class="line">        update[i] = x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    level = zslRandomLevel();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æœªä½¿ç”¨å±‚çº§</span></span><br><span class="line">    <span class="keyword">if</span> (level &gt; zsl-&gt;level) &#123;</span><br><span class="line">        <span class="keyword">for</span> (i = zsl-&gt;level; i &lt; level; i++) &#123;</span><br><span class="line">            rank[i] = <span class="number">0</span>;</span><br><span class="line">            update[i] = zsl-&gt;header;</span><br><span class="line">            update[i]-&gt;level[i].span = zsl-&gt;length;</span><br><span class="line">        &#125;</span><br><span class="line">        zsl-&gt;level = level;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    x = zslCreateNode(level,score,obj);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŠŠ update è®°å½•çš„ä½ç½®, æ‹¿æ¥åšä¿®æ­£</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; level; i++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç®€å•çš„é“¾è¡¨æ’å…¥æ“ä½œ, ä½ åªéœ€è¦è®°ä½, update[i]-&gt;x-&gt;update[i].forward</span></span><br><span class="line">        x-&gt;level[i].forward = update[i]-&gt;level[i].forward;</span><br><span class="line">        update[i]-&gt;level[i].forward = x;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// rank[0] æ˜¯æœ€åº•å±‚é“¾è¡¨çš„ x çš„å‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        <span class="comment">// rank[i] æ˜¯ç¬¬iå±‚é“¾è¡¨ è·ç¦» x çš„å‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        <span class="comment">// ç›¸å½“äºä¿®å¤ä¸€ä¸‹ ç¬¬iå±‚é“¾è¡¨è·ç¦»xçš„å‰ä¸€ä¸ªèŠ‚ç‚¹çš„spanå€¼</span></span><br><span class="line">        x-&gt;level[i].span = update[i]-&gt;level[i].span - (rank[<span class="number">0</span>] - rank[i]);</span><br><span class="line">        update[i]-&gt;level[i].span = (rank[<span class="number">0</span>] - rank[i]) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = level; i &lt; zsl-&gt;level; i++) &#123;</span><br><span class="line">        update[i]-&gt;level[i].span++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    x-&gt;backward = (update[<span class="number">0</span>] == zsl-&gt;header) ? <span class="literal">NULL</span> : update[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (x-&gt;level[<span class="number">0</span>].forward)</span><br><span class="line">        x-&gt;level[<span class="number">0</span>].forward-&gt;backward = x;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        zsl-&gt;tail = x;</span><br><span class="line"></span><br><span class="line">    zsl-&gt;length++;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="GetRank-è·å–æ’å"><a href="#GetRank-è·å–æ’å" class="headerlink" title="GetRank è·å–æ’å"></a>GetRank è·å–æ’å</h3><p>ä¸€æ ·ä»æœ€ä¸Šå±‚å¼€å§‹æ‰¾â€¦ ç„¶åç´¯è®¡ span å€¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">long</span> <span class="title function_">zslGetRank</span><span class="params">(zskiplist *zsl, <span class="type">double</span> score, robj *o)</span> &#123;</span><br><span class="line">    zskiplistNode *x;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> rank = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">    x = zsl-&gt;header;</span><br><span class="line">    <span class="keyword">for</span> (i = zsl-&gt;level<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (x-&gt;level[i].forward &amp;&amp;</span><br><span class="line">            (x-&gt;level[i].forward-&gt;score &lt; score ||</span><br><span class="line">                (x-&gt;level[i].forward-&gt;score == score &amp;&amp;</span><br><span class="line">                compareStringObjects(x-&gt;level[i].forward-&gt;obj,o) &lt;= <span class="number">0</span>))) &#123;</span><br><span class="line"></span><br><span class="line">            rank += x-&gt;level[i].span;</span><br><span class="line"></span><br><span class="line">            x = x-&gt;level[i].forward;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (x-&gt;obj &amp;&amp; equalStringObjects(x-&gt;obj,o)) &#123;</span><br><span class="line">            <span class="keyword">return</span> rank;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="GetElementByRank-æ ¹æ®æ’åæ‰¾å¯¹è±¡"><a href="#GetElementByRank-æ ¹æ®æ’åæ‰¾å¯¹è±¡" class="headerlink" title="GetElementByRank æ ¹æ®æ’åæ‰¾å¯¹è±¡"></a>GetElementByRank æ ¹æ®æ’åæ‰¾å¯¹è±¡</h3><p>ç”¨ traversed ç»Ÿè®¡æ„å¢ƒèµ°è¿‡çš„æ­¥é•¿, è¿™ä¸ªæ€è·¯è¿˜æ˜¯æ¯”è¾ƒæ¸…å¥‡çš„â€¦</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">zskiplistNode* <span class="title function_">zslGetElementByRank</span><span class="params">(zskiplist *zsl, <span class="type">unsigned</span> <span class="type">long</span> rank)</span> &#123;</span><br><span class="line">    zskiplistNode *x;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> traversed = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">    x = zsl-&gt;header;</span><br><span class="line">    <span class="keyword">for</span> (i = zsl-&gt;level<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (x-&gt;level[i].forward &amp;&amp; (traversed + x-&gt;level[i].span) &lt;= rank)</span><br><span class="line">        &#123;</span><br><span class="line">            traversed += x-&gt;level[i].span;</span><br><span class="line">            x = x-&gt;level[i].forward;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (traversed == rank) &#123;</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ²¡æ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤, Redis ä¸­çš„ SkipList å·²ç»åŸºæœ¬äº†è§£å®Œäº†.</p><h2 id="æ’è¡Œæ¦œçš„å¦ç±»åšæ³•"><a href="#æ’è¡Œæ¦œçš„å¦ç±»åšæ³•" class="headerlink" title="æ’è¡Œæ¦œçš„å¦ç±»åšæ³•"></a>æ’è¡Œæ¦œçš„å¦ç±»åšæ³•</h2><p>å…¶å®å¦‚æœä½ çŸ¥é“ ç©å®¶çš„åˆ†å€¼çš„åŒºé—´, ä¾‹å¦‚çš‡å®¤æˆ˜äº‰çš„çš‡å† æ¯æ•°å¤§è‡´çš„èŒƒå›´ä½ æ˜¯çŸ¥é“çš„, é‚£ä½ å…¶å®å¯ä»¥è¿™ä¹ˆæ¥åš</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;vector&lt;<span class="type">uint32_t</span>&gt;&gt; array;</span><br><span class="line">array[çš‡å† æ•°].<span class="built_in">push_back</span>(ğŸ‘‘çš„key);</span><br><span class="line">è¿™æ ·è¦å–å‡ºå…¶æ’å, åªéœ€è¦ç´¯åŠ å‰é¢çš„ æ•°ç»„å°±å¯ä»¥äº†..</span><br><span class="line"></span><br><span class="line">å‡è®¾ åˆ†å€¼ä¸º <span class="number">1</span> - <span class="number">5</span> </span><br><span class="line">[<span class="number">5</span>] [<span class="number">4</span>] [<span class="number">3</span>] [<span class="number">2</span>] [<span class="number">1</span>]</span><br><span class="line">k1  k4  k2  k5  k7</span><br><span class="line">k3      k6</span><br><span class="line"></span><br><span class="line">é‚£ä½ è¦å¾—åˆ° k2 çš„æ’å, ä½ åªéœ€è¦ ç´¯åŠ  [<span class="number">5</span>] + [<span class="number">4</span>] çš„å¤§å°å°±èƒ½ç®—å‡ºæ¥</span><br></pre></td></tr></table></figure></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Redis/" rel="tag"># Redis</a> <a href="/tags/SkipList/" rel="tag"># SkipList</a> <a href="/tags/%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E5%99%A8/" rel="tag"># æ¸¸æˆæœåŠ¡å™¨</a> <a href="/tags/%E6%8E%92%E8%A1%8C%E6%A6%9C/" rel="tag"># æ’è¡Œæ¦œ</a></div><div class="post-nav"><div class="post-nav-item"><a href="/Linux%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8BIO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/" rel="prev" title="Linuxç½‘ç»œç¼–ç¨‹ I/Oå¤šè·¯å¤ç”¨"><i class="fa fa-angle-left"></i> Linuxç½‘ç»œç¼–ç¨‹ I/Oå¤šè·¯å¤ç”¨</a></div><div class="post-nav-item"><a href="/Lua5.3-%E8%AE%BE%E8%AE%A1%E5%AE%9E%E7%8E%B0(%E4%B8%80)-Lua%E6%98%AF%E6%80%8E%E4%B9%88%E8%B7%91%E8%B5%B7%E6%9D%A5%E7%9A%84/" rel="next" title="Lua 5.3 è®¾è®¡å®ç°(ä¸€) Luaæ˜¯æ€ä¹ˆè·‘èµ·æ¥çš„?">Lua 5.3 è®¾è®¡å®ç°(ä¸€) Luaæ˜¯æ€ä¹ˆè·‘èµ·æ¥çš„? <i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2018 â€“ <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Yuerer</span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><div class="reading-progress-bar"></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://unpkg.com/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://unpkg.com/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.21.1/comments.min.js"></script><script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.21.1/utils.min.js"></script><script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.21.1/motion.min.js"></script><script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.21.1/sidebar.min.js"></script><script src="https://s4.zstatic.net/ajax/libs/hexo-theme-next/8.21.1/next-boot.min.js"></script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://yuerer-comment-xufei-0bea01e6f05-1307930306.ap-shanghai.app.tcloudbase.com","cssUrl":"https://s4.zstatic.net/ajax/libs/waline/2.15.8/waline.css","commentCount":true,"pageview":true,"libUrl":"https://s4.zstatic.net/ajax/libs/waline/2.15.8/waline.js","locale":{"placeholder":"æœ‰ä½•é«˜è§ï¼Ÿ"},"emoji":["https://unpkg.com/@waline/emojis@1.0.1/qq"],"meta":["nick","mail"],"requiredMeta":[["nick","mail"]],"wordLimit":0,"login":"disable","pageSize":10,"el":"#waline","comment":true,"path":"/SkipList-%E5%8E%9F%E7%90%86%E5%8F%8A%E5%9C%A8%E6%B8%B8%E6%88%8F%E6%8E%92%E8%A1%8C%E6%A6%9C%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/"}</script><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/waline/2.15.8/waline.css"><script>document.addEventListener("page:loaded",()=>{NexT.utils.loadComments(CONFIG.waline.el).then(()=>NexT.utils.getScript(CONFIG.waline.libUrl,{condition:window.Waline})).then(()=>Waline.init(Object.assign({},CONFIG.waline,{el:document.querySelector(CONFIG.waline.el)})))})</script></body></html>